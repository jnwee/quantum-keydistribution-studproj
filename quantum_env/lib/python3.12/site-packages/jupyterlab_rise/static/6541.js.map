{"version":3,"file":"6541.bundle.js","mappings":"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","sources":["webpack://_JUPYTERLAB.CORE_OUTPUT/../node_modules/reveal.js-plugins/chalkboard/plugin.js"],"sourcesContent":["/*****************************************************************\n ** Author: Asvin Goel, goel@telematique.eu\n **\n ** A plugin for reveal.js adding a chalkboard.\n **\n ** Version: 2.1.0\n **\n ** License: MIT license (see LICENSE.md)\n **\n ** Credits:\n ** Chalkboard effect by Mohamed Moustafa https://github.com/mmoustafa/Chalkboard\n ** Multi color support initially added by Kurt Rinnert https://github.com/rinnert\n ** Compatibility with reveal.js v4 by Hakim El Hattab https://github.com/hakimel\n ******************************************************************/\n\nwindow.RevealChalkboard = window.RevealChalkboard || {\n\tid: 'RevealChalkboard',\n\tinit: function ( deck ) {\n\t\tinitChalkboard( deck );\n\t},\n\tconfigure: function ( config ) {\n\t\tconfigure( config );\n\t},\n\ttoggleNotesCanvas: function () {\n\t\ttoggleNotesCanvas();\n\t},\n\ttoggleChalkboard: function () {\n\t\ttoggleChalkboard();\n\t},\n\tcolorIndex: function () {\n\t\tcolorIndex();\n\t},\n\tcolorNext: function () {\n\t\tcolorNext();\n\t},\n\tcolorPrev: function () {\n\t\tcolorPrev();\n\t},\n\tclear: function () {\n\t\tclear();\n\t},\n\treset: function () {\n\t\treset();\n\t},\n\tresetAll: function () {\n\t\tresetAll();\n\t},\n\tupdateStorage: function () {\n\t\tupdateStorage();\n\t},\n\tgetData: function () {\n\t\treturn getData();\n\t},\n\tdownload: function () {\n\t\tdownload();\n\t},\n};\n\nfunction scriptPath() {\n\t// obtain plugin path from the script element\n\tvar src;\n\tif ( document.currentScript ) {\n\t\tsrc = document.currentScript.src;\n\t} else {\n\t\tvar sel = document.querySelector( 'script[src$=\"/chalkboard/plugin.js\"]' )\n\t\tif ( sel ) {\n\t\t\tsrc = sel.src;\n\t\t}\n\t}\n\tvar path = ( src === undefined ) ? \"\" : src.slice( 0, src.lastIndexOf( \"/\" ) + 1 );\n//console.log(\"Path: \" + path);\n\treturn path;\n}\nvar path = scriptPath();\n\nconst initChalkboard = function ( Reveal ) {\n//console.warn(path);\n\t/* Feature detection for passive event handling*/\n\tvar passiveSupported = false;\n\n\ttry {\n\t\twindow.addEventListener( 'test', null, Object.defineProperty( {}, 'passive', {\n\t\t\tget: function () {\n\t\t\t\tpassiveSupported = true;\n\t\t\t}\n\t\t} ) );\n\t} catch ( err ) {}\n\n\n/*****************************************************************\n ** Configuration\n ******************************************************************/\n\tvar background, pen, draw, color;\n\tvar grid = false;\n\tvar boardmarkerWidth = 3;\n\tvar chalkWidth = 7;\n\tvar chalkEffect = 1.0;\n\tvar rememberColor = [ true, false ];\n\tvar eraser = {\n\t\tsrc: path + 'img/sponge.png',\n\t\tradius: 20\n\t};\n\tvar boardmarkers = [ {\n\t\t\tcolor: 'rgba(100,100,100,1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-black.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(30,144,255, 1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-blue.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(220,20,60,1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-red.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(50,205,50,1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-green.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(255,140,0,1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-orange.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(150,0,20150,1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-purple.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(255,220,0,1)',\n\t\t\tcursor: 'url(' + path + 'img/boardmarker-yellow.png), auto'\n\t\t}\n\t];\n\tvar chalks = [ {\n\t\t\tcolor: 'rgba(255,255,255,0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-white.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(96, 154, 244, 0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-blue.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(237, 20, 28, 0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-red.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(20, 237, 28, 0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-green.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(220, 133, 41, 0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-orange.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(220,0,220,0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-purple.png), auto'\n\t\t},\n\t\t{\n\t\t\tcolor: 'rgba(255,220,0,0.5)',\n\t\t\tcursor: 'url(' + path + 'img/chalk-yellow.png), auto'\n\t\t}\n\t];\n\tvar keyBindings = {\n\t\ttoggleNotesCanvas: {\n\t\t\tkeyCode: 67,\n\t\t\tkey: 'C',\n\t\t\tdescription: 'Toggle notes canvas'\n\t\t},\n\t\ttoggleChalkboard: {\n\t\t\tkeyCode: 66,\n\t\t\tkey: 'B',\n\t\t\tdescription: 'Toggle chalkboard'\n\t\t},\n\t\tclear: {\n\t\t\tkeyCode: 46,\n\t\t\tkey: 'DEL',\n\t\t\tdescription: 'Clear drawings on slide'\n\t\t},\n/*\n\t\treset: {\n\t\t\tkeyCode: 173,\n\t\t\tkey: '-',\n\t\t\tdescription: 'Reset drawings on slide'\n\t\t},\n*/\n\t\tresetAll: {\n\t\t\tkeyCode: 8,\n\t\t\tkey: 'BACKSPACE',\n\t\t\tdescription: 'Reset all drawings'\n\t\t},\n\t\tcolorNext: {\n\t\t\tkeyCode: 88,\n\t\t\tkey: 'X',\n\t\t\tdescription: 'Next color'\n\t\t},\n\t\tcolorPrev: {\n\t\t\tkeyCode: 89,\n\t\t\tkey: 'Y',\n\t\t\tdescription: 'Previous color'\n\t\t},\n\t\tdownload: {\n\t\t\tkeyCode: 68,\n\t\t\tkey: 'D',\n\t\t\tdescription: 'Download drawings'\n\t\t}\n\t};\n\n\n\tvar theme = 'chalkboard';\n\tvar color = [ 0, 0 ];\n\tvar toggleChalkboardButton = false;\n\tvar toggleNotesButton = false;\n\tvar colorButtons = true;\n\tvar boardHandle = true;\n\tvar transition = 800;\n\n\tvar readOnly = false;\n\tvar messageType = 'broadcast';\n\n\tvar config = configure( Reveal.getConfig().chalkboard || {} );\n\tif ( config.keyBindings ) {\n\t\tfor ( var key in config.keyBindings ) {\n\t\t\tkeyBindings[ key ] = config.keyBindings[ key ];\n\t\t};\n\t}\n\n\tfunction configure( config ) {\n\n\t\tif ( config.boardmarkerWidth || config.penWidth ) boardmarkerWidth = config.boardmarkerWidth || config.penWidth;\n\t\tif ( config.chalkWidth ) chalkWidth = config.chalkWidth;\n\t\tif ( config.chalkEffect ) chalkEffect = config.chalkEffect;\n\t\tif ( config.rememberColor ) rememberColor = config.rememberColor;\n\t\tif ( config.eraser ) eraser = config.eraser;\n\t\tif ( config.boardmarkers ) boardmarkers = config.boardmarkers;\n\t\tif ( config.chalks ) chalks = config.chalks;\n\n\t\tif ( config.theme ) theme = config.theme;\n\t\tswitch ( theme ) {\n\t\tcase 'whiteboard':\n\t\t\tbackground = [ 'rgba(127,127,127,.1)', path + 'img/whiteboard.png' ];\n\t\t\tdraw = [ drawWithBoardmarker, drawWithBoardmarker ];\n\t\t\tpens = [ boardmarkers, boardmarkers ];\n\t\t\tgrid = {\n\t\t\t\tcolor: 'rgb(127,127,255,0.1)',\n\t\t\t\tdistance: 40,\n\t\t\t\twidth: 2\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'chalkboard':\n\t\tdefault:\n\t\t\tbackground = [ 'rgba(127,127,127,.1)', path + 'img/blackboard.png' ];\n\t\t\tdraw = [ drawWithBoardmarker, drawWithChalk ];\n\t\t\tpens = [ boardmarkers, chalks ];\n\t\t\tgrid = {\n\t\t\t\tcolor: 'rgb(50,50,10,0.5)',\n\t\t\t\tdistance: 80,\n\t\t\t\twidth: 2\n\t\t\t};\n\t\t}\n\n\t\tif ( config.background ) background = config.background;\n\t\tif ( config.grid != undefined ) grid = config.grid;\n\n\t\tif ( config.toggleChalkboardButton != undefined ) toggleChalkboardButton = config.toggleChalkboardButton;\n\t\tif ( config.toggleNotesButton != undefined ) toggleNotesButton = config.toggleNotesButton;\n\t\tif ( config.colorButtons != undefined ) colorButtons = config.colorButtons;\n\t\tif ( config.boardHandle != undefined ) boardHandle = config.boardHandle;\n\t\tif ( config.transition ) transition = config.transition;\n\n\t\tif ( config.readOnly != undefined ) readOnly = config.readOnly;\n\t\tif ( config.messageType ) messageType = config.messageType;\n\n\t\tif ( drawingCanvas && ( config.theme || config.background || config.grid ) ) {\n\t\t\tvar canvas = document.getElementById( drawingCanvas[ 1 ].id );\n\t\t\tcanvas.style.background = 'url(\"' + background[ 1 ] + '\") repeat';\n\t\t\tclearCanvas( 1 );\n\t\t\tdrawGrid();\n\t\t}\n\n\t\treturn config;\n\t}\n/*****************************************************************\n ** Setup\n ******************************************************************/\n\n\tfunction whenReady( callback ) {\n\t\t// wait for markdown to be parsed and code to be highlighted\n\t\tif ( !document.querySelector( 'section[data-markdown]:not([data-markdown-parsed])' ) \n\t\t     && !document.querySelector( 'code[data-line-numbers*=\"|\"]') \t\n\t\t) {\n\t\t\tcallback();\n\t\t} else {\n\t\t\tconsole.log( \"Wait for markdown to be parsed and code to be highlighted\" );\n\t\t\tsetTimeout( whenReady, 500, callback )\n\t\t}\n\t}\n\n\tfunction whenLoaded( callback ) {\n\t\t// wait for drawings to be loaded and markdown to be parsed\n\t\tif ( loaded !== null ) {\n\t\t\tcallback();\n\t\t} else {\n\t\t\tconsole.log( \"Wait for drawings to be loaded\" );\n\t\t\tsetTimeout( whenLoaded, 500, callback )\n\t\t}\n\t}\n\n\tif ( toggleChalkboardButton ) {\nconsole.warn( \"toggleChalkboardButton is deprecated, use customcontrols plugin instead!\" );\n//console.log(\"toggleChalkboardButton\")\n\t\tvar button = document.createElement( 'div' );\n\t\tbutton.className = \"chalkboard-button\";\n\t\tbutton.id = \"toggle-chalkboard\";\n\t\tbutton.style.visibility = \"visible\";\n\t\tbutton.style.position = \"absolute\";\n\t\tbutton.style.zIndex = 30;\n\t\tbutton.style.fontSize = \"24px\";\n\n\t\tbutton.style.left = toggleChalkboardButton.left || \"30px\";\n\t\tbutton.style.bottom = toggleChalkboardButton.bottom || \"30px\";\n\t\tbutton.style.top = toggleChalkboardButton.top || \"auto\";\n\t\tbutton.style.right = toggleChalkboardButton.right || \"auto\";\n\n\t\tbutton.innerHTML = '<a href=\"#\" title=\"Toggle chalkboard (' + keyBindings.toggleChalkboard.key + ')\" onclick=\"RevealChalkboard.toggleChalkboard(); return false;\"><i class=\"fa fa-pen-square\"></i></a>'\n\t\tdocument.querySelector( \".reveal\" ).appendChild( button );\n\t}\n\tif ( toggleNotesButton ) {\nconsole.warn( \"toggleNotesButton is deprecated, use customcontrols plugin instead!\" );\n//console.log(\"toggleNotesButton\")\n\t\tvar button = document.createElement( 'div' );\n\t\tbutton.className = \"chalkboard-button\";\n\t\tbutton.id = \"toggle-notes\";\n\t\tbutton.style.position = \"absolute\";\n\t\tbutton.style.zIndex = 30;\n\t\tbutton.style.fontSize = \"24px\";\n\n\t\tbutton.style.left = toggleNotesButton.left || \"70px\";\n\t\tbutton.style.bottom = toggleNotesButton.bottom || \"30px\";\n\t\tbutton.style.top = toggleNotesButton.top || \"auto\";\n\t\tbutton.style.right = toggleNotesButton.right || \"auto\";\n\n\t\tbutton.innerHTML = '<a href=\"#\" title=\"Toggle slide annotation (' + keyBindings.toggleNotesCanvas.key + ')\" onclick=\"RevealChalkboard.toggleNotesCanvas(); return false;\"><i class=\"fa fa-pen\"></i></a>'\n\t\tdocument.querySelector( \".reveal\" ).appendChild( button );\n\t}\n\n\tvar drawingCanvas = [ {\n\t\tid: 'notescanvas'\n\t}, {\n\t\tid: 'chalkboard'\n\t} ];\n\tsetupDrawingCanvas( 0 );\n\tsetupDrawingCanvas( 1 );\n\n\tvar mode = 0; // 0: notes canvas, 1: chalkboard\n\tvar board = 0; // board index (only for chalkboard)\n\n\tvar mouseX = 0;\n\tvar mouseY = 0;\n\tvar lastX = null;\n\tvar lastY = null;\n\n\tvar drawing = false;\n\tvar erasing = false;\n\n\tvar slideStart = Date.now();\n\tvar slideIndices = {\n\t\th: 0,\n\t\tv: 0\n\t};\n\n\tvar timeouts = [\n\t\t[],\n\t\t[]\n\t];\n\tvar touchTimeout = null;\n\tvar slidechangeTimeout = null;\n\tvar updateStorageTimeout = null;\n\tvar playback = false;\n\n\tfunction createPalette( colors, length ) {\n\t\tif ( length === true || length > colors.length ) {\n\t\t\tlength = colors.length;\n\t\t}\n\t\tvar palette = document.createElement( 'div' );\n\t\tpalette.classList.add( 'palette' );\n\t\tvar list = document.createElement( 'ul' );\n\t\t// color pickers\n\t\tfor ( var i = 0; i < length; i++ ) {\n\t\t\tvar colorButton = document.createElement( 'li' );\n\t\t\tcolorButton.setAttribute( 'data-color', i );\n\t\t\tcolorButton.innerHTML = '<i class=\"fa fa-square\"></i>';\n\t\t\tcolorButton.style.color = colors[ i ].color;\n\t\t\tcolorButton.addEventListener( 'click', function ( e ) {\n\t\t\t\tvar element = e.target;\n\t\t\t\twhile ( !element.hasAttribute( 'data-color' ) ) {\n\t\t\t\t\telement = element.parentElement;\n\t\t\t\t}\n\t\t\t\tcolorIndex( parseInt( element.getAttribute( 'data-color' ) ) );\n\t\t\t} );\n\t\t\tcolorButton.addEventListener( 'touchstart', function ( e ) {\n\t\t\t\tvar element = e.target;\n\t\t\t\twhile ( !element.hasAttribute( 'data-color' ) ) {\n\t\t\t\t\telement = element.parentElement;\n\t\t\t\t}\n\t\t\t\tcolorIndex( parseInt( element.getAttribute( 'data-color' ) ) );\n\t\t\t} );\n\t\t\tlist.appendChild( colorButton );\n\t\t}\n\t\tpalette.appendChild( list );\n\t\treturn palette;\n\t};\n\n\tfunction switchBoard( boardIdx ) {\n\t\tselectBoard( boardIdx, true );\n\t\t// broadcast\n\t\tvar message = new CustomEvent( messageType );\n\t\t\tmessage.content = {\n\t\t\tsender: 'chalkboard-plugin',\n\t\t\ttype: 'selectboard',\n\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\tmode,\n\t\t\tboard\n\t\t};\n\t\tdocument.dispatchEvent( message );\t\n\t}\n\n\tfunction setupDrawingCanvas( id ) {\n\t\tvar container = document.createElement( 'div' );\n\t\tcontainer.id = drawingCanvas[ id ].id;\n\t\tcontainer.classList.add( 'overlay' );\n\t\tcontainer.setAttribute( 'data-prevent-swipe', 'true' );\n\t\tcontainer.oncontextmenu = function () {\n\t\t\treturn false;\n\t\t}\n\t\tcontainer.style.cursor = pens[ id ][ color[ id ] ].cursor;\n\n\t\tdrawingCanvas[ id ].width = window.innerWidth;\n\t\tdrawingCanvas[ id ].height = window.innerHeight;\n\t\tdrawingCanvas[ id ].scale = 1;\n\t\tdrawingCanvas[ id ].xOffset = 0;\n\t\tdrawingCanvas[ id ].yOffset = 0;\n\n\t\tif ( id == \"0\" ) {\n\t\t\tcontainer.style.background = 'rgba(0,0,0,0)';\n\t\t\tcontainer.style.zIndex = 24;\n\t\t\tcontainer.style.opacity = 1;\n\t\t\tcontainer.style.visibility = 'visible';\n\t\t\tcontainer.style.pointerEvents = 'none';\n\n\t\t\tvar slides = document.querySelector( '.slides' );\n\t\t\tvar aspectRatio = Reveal.getConfig().width / Reveal.getConfig().height;\n\t\t\tif ( drawingCanvas[ id ].width > drawingCanvas[ id ].height * aspectRatio ) {\n\t\t\t\tdrawingCanvas[ id ].xOffset = ( drawingCanvas[ id ].width - drawingCanvas[ id ].height * aspectRatio ) / 2;\n\t\t\t} else if ( drawingCanvas[ id ].height > drawingCanvas[ id ].width / aspectRatio ) {\n\t\t\t\tdrawingCanvas[ id ].yOffset = ( drawingCanvas[ id ].height - drawingCanvas[ id ].width / aspectRatio ) / 2;\n\t\t\t}\n\n\t\t\tif ( colorButtons ) {\n\t\t\t\tvar palette = createPalette( boardmarkers, colorButtons );\n\t\t\t\tpalette.style.visibility = 'hidden'; // only show palette in drawing mode\n\t\t\t\tcontainer.appendChild( palette );\n\t\t\t}\n\t\t} else {\n\t\t\tcontainer.style.background = 'url(\"' + background[ id ] + '\") repeat';\n\t\t\tcontainer.style.zIndex = 26;\n\t\t\tcontainer.style.opacity = 0;\n\t\t\tcontainer.style.visibility = 'hidden';\n\n\t\t\tif ( colorButtons ) {\n\t\t\t\tvar palette = createPalette( chalks, colorButtons );\n\t\t\t\tcontainer.appendChild( palette );\n\t\t\t}\n\t\t\tif ( boardHandle ) {\n\t\t\t\tvar handle = document.createElement( 'div' );\n\t\t\t\thandle.classList.add( 'boardhandle' );\n\t\t\t\thandle.innerHTML = '<ul><li><a id=\"previousboard\" href=\"#\" title=\"Previous board\"><i class=\"fas fa-chevron-up\"></i></a></li><li><a id=\"nextboard\" href=\"#\" title=\"Next board\"><i class=\"fas fa-chevron-down\"></i></a></li></ul>';\n\t\t\t\thandle.querySelector( '#previousboard' ).addEventListener( 'click', function ( e ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tswitchBoard( board - 1 );\n\t\t\t\t} );\n\t\t\t\thandle.querySelector( '#nextboard' ).addEventListener( 'click', function ( e ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tswitchBoard( board + 1 );\n\t\t\t\t} );\n\t\t\t\thandle.querySelector( '#previousboard' ).addEventListener( 'touchstart', function ( e ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tswitchBoard( board - 1 );\n\t\t\t\t} );\n\t\t\t\thandle.querySelector( '#nextboard' ).addEventListener( 'touchstart', function ( e ) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tswitchBoard( board + 1 );\n\t\t\t\t} );\n\n\t\t\t\tcontainer.appendChild( handle );\n\t\t\t}\n\t\t}\n\n\n\t\tvar sponge = document.createElement( 'img' );\n\t\tsponge.src = eraser.src;\n\t\tsponge.id = 'sponge';\n\t\tsponge.style.visibility = 'hidden';\n\t\tsponge.style.position = 'absolute';\n\t\tcontainer.appendChild( sponge );\n\t\tdrawingCanvas[ id ].sponge = sponge;\n\n\t\tvar canvas = document.createElement( 'canvas' );\n\t\tcanvas.width = drawingCanvas[ id ].width;\n\t\tcanvas.height = drawingCanvas[ id ].height;\n\t\tcanvas.setAttribute( 'data-chalkboard', id );\n\t\tcanvas.style.cursor = pens[ id ][ color[ id ] ].cursor;\n\t\tcontainer.appendChild( canvas );\n\t\tdrawingCanvas[ id ].canvas = canvas;\n\n\t\tdrawingCanvas[ id ].context = canvas.getContext( '2d' );\n\n\t\tsetupCanvasEvents( container );\n\n\t\tdocument.querySelector( '.reveal' ).appendChild( container );\n\t\tdrawingCanvas[ id ].container = container;\n\t}\n\n\n/*****************************************************************\n ** Storage\n ******************************************************************/\n\n\tvar storage = [ {\n\t\t\twidth: Reveal.getConfig().width,\n\t\t\theight: Reveal.getConfig().height,\n\t\t\tdata: []\n\t\t},\n\t\t{\n\t\t\twidth: Reveal.getConfig().width,\n\t\t\theight: Reveal.getConfig().height,\n\t\t\tdata: []\n\t\t}\n\t];\n\n\tvar loaded = null;\n\n\tif ( config.storage ) {\n\t\t// Get chalkboard drawings from session storage\n\t\tloaded = initStorage( sessionStorage.getItem( config.storage ) );\n\t}\n\n\tif ( !loaded && config.src != null ) {\n\t\t// Get chalkboard drawings from the given file\n\t\tloadData( config.src );\n\t}\n\n\t/**\n\t * Initialize storage.\n\t */\n\tfunction initStorage( json ) {\n\t\tvar success = false;\n\t\ttry {\n\t\t\tvar data = JSON.parse( json );\n\t\t\tfor ( var id = 0; id < data.length; id++ ) {\n\t\t\t\tif ( drawingCanvas[ id ].width != data[ id ].width || drawingCanvas[ id ].height != data[ id ].height ) {\n\t\t\t\t\tdrawingCanvas[ id ].scale = Math.min( drawingCanvas[ id ].width / data[ id ].width, drawingCanvas[ id ].height / data[ id ].height );\n\t\t\t\t\tdrawingCanvas[ id ].xOffset = ( drawingCanvas[ id ].width - data[ id ].width * drawingCanvas[ id ].scale ) / 2;\n\t\t\t\t\tdrawingCanvas[ id ].yOffset = ( drawingCanvas[ id ].height - data[ id ].height * drawingCanvas[ id ].scale ) / 2;\n\t\t\t\t}\n\t\t\t\tif ( config.readOnly ) {\n\t\t\t\t\tdrawingCanvas[ id ].container.style.cursor = 'default';\n\t\t\t\t\tdrawingCanvas[ id ].canvas.style.cursor = 'default';\n\t\t\t\t}\n\t\t\t}\n\t\t\tsuccess = true;\n\t\t\tstorage = data;\n\t\t} catch ( err ) {\n\t\t\tconsole.warn( \"Cannot initialise storage!\" );\n\t\t}\n\t\treturn success;\n\t}\n\n\n\t/**\n\t * Load data.\n\t */\n\tfunction loadData( filename ) {\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onload = function () {\n\t\t\tif ( xhr.readyState === 4 && xhr.status != 404 ) {\n\t\t\t\tloaded = initStorage( xhr.responseText );\n\t\t\t\tupdateStorage();\n\t\t\t\tconsole.log( \"Drawings loaded from file\" );\n\t\t\t} else {\n\t\t\t\tconfig.readOnly = undefined;\n\t\t\t\treadOnly = undefined;\n\t\t\t\tconsole.warn( 'Failed to get file ' + filename + '. ReadyState: ' + xhr.readyState + ', Status: ' + xhr.status );\n\t\t\t\tloaded = false;\n\t\t\t}\n\t\t};\n\n\t\txhr.open( 'GET', filename, true );\n\t\ttry {\n\t\t\txhr.send();\n\t\t} catch ( error ) {\n\t\t\tconfig.readOnly = undefined;\n\t\t\treadOnly = undefined;\n\t\t\tconsole.warn( 'Failed to get file ' + filename + '. Make sure that the presentation and the file are served by a HTTP server and the file can be found there. ' + error );\n\t\t\tloaded = false;\n\t\t}\n\t}\n\n\n\tfunction storageChanged( now ) {\n\t\tif ( !now ) {\n\t\t\t// create or update timer\n\t\t\tif ( updateStorageTimeout ) {\n\t\t\t\tclearTimeout( updateStorageTimeout );\n\t\t\t}\n\t\t\tupdateStorageTimeout = setTimeout( storageChanged, 1000, true);\n\t\t}\n\t\telse {\n// console.log(\"Update storage\", updateStorageTimeout,  Date.now());\n\t\t\tupdateStorage();\n\t\t\tupdateStorageTimeout = null;\n\t\t}\n\t}\n\n\tfunction updateStorage() {\n\t\tvar json = JSON.stringify( storage )\n\t\tif ( config.storage ) {\n\t\t\tsessionStorage.setItem( config.storage, json )\n\t\t}\n\t\treturn json;\n\t}\n\n\tfunction recordEvent( event ) {\n//console.log(event);\n\t\tevent.time = Date.now() - slideStart;\n\t\tif ( mode == 1 ) event.board = board;\n\t\tvar slideData = getSlideData();\n\t\tvar i = slideData.events.length;\n\t\twhile ( i > 0 && event.time < slideData.events[ i - 1 ].time ) {\n\t\t\ti--;\n\t\t}\n\t\tslideData.events.splice( i, 0, event );\n\t\tslideData.duration = Math.max( slideData.duration, Date.now() - slideStart ) + 1;\n\n\t\tstorageChanged();\n\t}\n\n\t/**\n\t * Get data as json string.\n\t */\n\tfunction getData() {\n\t\t// cleanup slide data without events\n\t\tfor ( var id = 0; id < 2; id++ ) {\n\t\t\tfor ( var i = storage[ id ].data.length - 1; i >= 0; i-- ) {\n\t\t\t\tif ( storage[ id ].data[ i ].events.length == 0 ) {\n\t\t\t\t\tstorage[ id ].data.splice( i, 1 );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn updateStorage();\n\t}\n\n\t/**\n\t * Download data.\n\t */\n\tfunction downloadData() {\n\t\tvar a = document.createElement( 'a' );\n\t\tdocument.body.appendChild( a );\n\t\ttry {\n\t\t\ta.download = 'chalkboard.json';\n\t\t\tvar blob = new Blob( [ getData() ], {\n\t\t\t\ttype: 'application/json'\n\t\t\t} );\n\t\t\ta.href = window.URL.createObjectURL( blob );\n\t\t} catch ( error ) {\n\t\t\ta.innerHTML += ' (' + error + ')';\n\t\t}\n\t\ta.click();\n\t\tdocument.body.removeChild( a );\n\t}\n\n\t/**\n\t * Returns data object for the slide with the given indices.\n\t */\n\tfunction getSlideData( indices, id ) {\n\t\tif ( id == undefined ) id = mode;\n\t\tif ( !indices ) indices = slideIndices;\n\t\tvar data;\n\t\tfor ( var i = 0; i < storage[ id ].data.length; i++ ) {\n\t\t\tif ( storage[ id ].data[ i ].slide.h === indices.h && storage[ id ].data[ i ].slide.v === indices.v && storage[ id ].data[ i ].slide.f === indices.f ) {\n\t\t\t\tdata = storage[ id ].data[ i ];\n\t\t\t\treturn data;\n\t\t\t}\n\t\t}\n\t\tvar page = Number( Reveal.getCurrentSlide().getAttribute('data-pdf-page-number') ); \n//console.log( indices, Reveal.getCurrentSlide() );\n\t\tstorage[ id ].data.push( {\n\t\t\tslide: indices,\n\t\t\tpage,\n\t\t\tevents: [],\n\t\t\tduration: 0\n\t\t} );\n\t\tdata = storage[ id ].data[ storage[ id ].data.length - 1 ];\n\t\treturn data;\n\t}\n\n\t/**\n\t * Returns maximum duration of slide playback for both modes\n\t */\n\tfunction getSlideDuration( indices ) {\n\t\tif ( !indices ) indices = slideIndices;\n\t\tvar duration = 0;\n\t\tfor ( var id = 0; id < 2; id++ ) {\n\t\t\tfor ( var i = 0; i < storage[ id ].data.length; i++ ) {\n\t\t\t\tif ( storage[ id ].data[ i ].slide.h === indices.h && storage[ id ].data[ i ].slide.v === indices.v && storage[ id ].data[ i ].slide.f === indices.f ) {\n\t\t\t\t\tduration = Math.max( duration, storage[ id ].data[ i ].duration );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n//console.log( duration );\n\t\treturn duration;\n\t}\n\n/*****************************************************************\n ** Print\n ******************************************************************/\n\tvar printMode = ( /print-pdf/gi ).test( window.location.search );\n//console.log(\"createPrintout\" + printMode)\n\n\tfunction addPageNumbers() {\n\t\t// determine page number for printouts with fragments serialised\n\t\tvar slides = Reveal.getSlides();\n\t\tvar page = 0;\n\t\tfor ( var i=0; i < slides.length; i++) {\n\t\t\tslides[i].setAttribute('data-pdf-page-number',page.toString());\n\t\t\t// add number of fragments without fragment indices\n\t\t\tvar count = slides[i].querySelectorAll('.fragment:not([data-fragment-index])').length;\n\t\t\tvar fragments = slides[i].querySelectorAll('.fragment[data-fragment-index]');\n\t\t\tfor ( var j=0; j < fragments.length; j++) {\n\t\t\t\t// increasenumber of fragments by highest fragment index (which start at 0)\n\t\t\t\tif ( Number(fragments[j].getAttribute('data-fragment-index')) + 1 > count ) {\n\t\t\t\t\tcount = Number(fragments[j].getAttribute('data-fragment-index')) + 1;\n\t\t\t\t}\n\t\t\t}\n//console.log(count,fragments.length,( slides[i].querySelector('h1,h2,h3,h4')||{}).innerHTML, page); \n\t\t\tpage += count + 1;\n\t\t}\n\t}\n\n\tfunction createPrintout() {\n\t\t//console.warn(Reveal.getTotalSlides(),Reveal.getSlidesElement());\n\t\tif ( storage[ 1 ].data.length == 0 ) return;\n\t\tconsole.log( 'Create printout(s) for ' + storage[ 1 ].data.length + \" slides\" );\n\t\tdrawingCanvas[ 0 ].container.style.opacity = 0; // do not print notes canvas\n\t\tdrawingCanvas[ 0 ].container.style.visibility = 'hidden';\n\n\t\tvar patImg = new Image();\n\t\tpatImg.onload = function () {\n\t\t\tvar slides = Reveal.getSlides();\n//console.log(slides);\n\t\t\tfor ( var i = storage[ 1 ].data.length - 1; i >= 0; i-- ) {\n\t\t\t\tconsole.log( 'Create printout for slide ' + storage[ 1 ].data[ i ].slide.h + '.' + storage[ 1 ].data[ i ].slide.v );\n\t\t\t\tvar slideData = getSlideData( storage[ 1 ].data[ i ].slide, 1 );\n\t\t\t\tvar drawings = createDrawings( slideData, patImg );\n//console.log(\"Page:\", storage[ 1 ].data[ i ].page );\n//console.log(\"Slide:\", slides[storage[ 1 ].data[ i ].page] );\n\t\t\t\taddDrawings( slides[storage[ 1 ].data[ i ].page], drawings );\n\n\t\t\t}\n//\t\t\tReveal.sync();\n\t\t};\n\t\tpatImg.src = background[ 1 ];\n\t}\n\n\n\tfunction cloneCanvas( oldCanvas ) {\n\t\t//create a new canvas\n\t\tvar newCanvas = document.createElement( 'canvas' );\n\t\tvar context = newCanvas.getContext( '2d' );\n\t\t//set dimensions\n\t\tnewCanvas.width = oldCanvas.width;\n\t\tnewCanvas.height = oldCanvas.height;\n\t\t//apply the old canvas to the new one\n\t\tcontext.drawImage( oldCanvas, 0, 0 );\n\t\t//return the new canvas\n\t\treturn newCanvas;\n\t}\n\n\tfunction getCanvas( template, container, board ) {\n\t\tvar idx = container.findIndex( element => element.board === board );\n\t\tif ( idx === -1 ) {\n\t\t\tvar canvas = cloneCanvas( template );\n\t\t\tif ( !container.length ) {\n\t\t\t\tidx = 0;\n\t\t\t\tcontainer.push( {\n\t\t\t\t\tboard,\n\t\t\t\t\tcanvas\n\t\t\t\t} );\n\t\t\t} else if ( board < container[ 0 ].board ) {\n\t\t\t\tidx = 0;\n\t\t\t\tcontainer.unshift( {\n\t\t\t\t\tboard,\n\t\t\t\t\tcanvas\n\t\t\t\t} );\n\t\t\t} else if ( board > container[ container.length - 1 ].board ) {\n\t\t\t\tidx = container.length;\n\t\t\t\tcontainer.push( {\n\t\t\t\t\tboard,\n\t\t\t\t\tcanvas\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\treturn container[ idx ].canvas;\n\t}\n\n\tfunction createDrawings( slideData, patImg ) {\n\t\tvar width = Reveal.getConfig().width;\n\t\tvar height = Reveal.getConfig().height;\n\t\tvar scale = 1;\n\t\tvar xOffset = 0;\n\t\tvar yOffset = 0;\n\t\tif ( width != storage[ 1 ].width || height != storage[ 1 ].height ) {\n\t\t\tscale = Math.min( width / storage[ 1 ].width, height / storage[ 1 ].height );\n\t\t\txOffset = ( width - storage[ 1 ].width * scale ) / 2;\n\t\t\tyOffset = ( height - storage[ 1 ].height * scale ) / 2;\n\t\t}\n\t\tmode = 1;\n\t\tboard = 0;\n//\t\tconsole.log( 'Create printout(s) for slide ', slideData );\n\n\t\tvar drawings = [];\n\t\tvar template = document.createElement( 'canvas' );\n\t\ttemplate.width = width;\n\t\ttemplate.height = height;\n\n\t\tvar imgCtx = template.getContext( '2d' );\n\t\timgCtx.fillStyle = imgCtx.createPattern( patImg, 'repeat' );\n\t\timgCtx.rect( 0, 0, width, height );\n\t\timgCtx.fill();\n\n\t\tfor ( var j = 0; j < slideData.events.length; j++ ) {\n\t\t\tswitch ( slideData.events[ j ].type ) {\n\t\t\tcase 'draw':\n\t\t\t\tdraw[ 1 ]( getCanvas( template, drawings, board ).getContext( '2d' ),\n\t\t\t\t\txOffset + slideData.events[ j ].x1 * scale,\n\t\t\t\t\tyOffset + slideData.events[ j ].y1 * scale,\n\t\t\t\t\txOffset + slideData.events[ j ].x2 * scale,\n\t\t\t\t\tyOffset + slideData.events[ j ].y2 * scale,\n\t\t\t\t\tyOffset + slideData.events[ j ].color\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase 'erase':\n\t\t\t\teraseWithSponge( getCanvas( template, drawings, board ).getContext( '2d' ),\n\t\t\t\t\txOffset + slideData.events[ j ].x * scale,\n\t\t\t\t\tyOffset + slideData.events[ j ].y * scale\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase 'selectboard':\n\t\t\t\tselectBoard( slideData.events[ j ].board );\n\t\t\t\tbreak;\n\t\t\tcase 'clear':\n\t\t\t\tgetCanvas( template, drawings, board ).getContext( '2d' ).clearRect( 0, 0, width, height );\n\t\t\t\tgetCanvas( template, drawings, board ).getContext( '2d' ).fill();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tdrawings = drawings.sort( ( a, b ) => a.board > b.board && 1 || -1 );\n\n\t\tmode = 0;\n\n\t\treturn drawings;\n\t}\n\n\tfunction addDrawings( slide, drawings ) {\n\t\tvar parent = slide.parentElement.parentElement;\n\t\tvar nextSlide = slide.parentElement.nextElementSibling;\n\n\t\tfor ( var i = 0; i < drawings.length; i++ ) {\n\t\t\tvar newPDFPage = document.createElement( 'div' );\n\t\t\tnewPDFPage.classList.add( 'pdf-page' );\n\t\t\tnewPDFPage.style.height = Reveal.getConfig().height;\n\t\t\tnewPDFPage.append( drawings[ i ].canvas );\n//console.log(\"Add drawing\", newPDFPage);\n\t\t\tif ( nextSlide != null ) {\n\t\t\t\tparent.insertBefore( newPDFPage, nextSlide );\n\t\t\t} else {\n\t\t\t\tparent.append( newPDFPage );\n\t\t\t}\n\t\t}\n\t}\n\n\t/*****************************************************************\n\t ** Drawings\n\t ******************************************************************/\n\n\tfunction drawWithBoardmarker( context, fromX, fromY, toX, toY, colorIdx ) {\n\t\tif ( colorIdx == undefined ) colorIdx = color[ mode ];\n\t\tcontext.lineWidth = boardmarkerWidth;\n\t\tcontext.lineCap = 'round';\n\t\tcontext.strokeStyle = boardmarkers[ colorIdx ].color;\n\t\tcontext.beginPath();\n\t\tcontext.moveTo( fromX, fromY );\n\t\tcontext.lineTo( toX, toY );\n\t\tcontext.stroke();\n\t}\n\n\tfunction drawWithChalk( context, fromX, fromY, toX, toY, colorIdx ) {\n\t\tif ( colorIdx == undefined ) colorIdx = color[ mode ];\n\t\tvar brushDiameter = chalkWidth;\n\t\tcontext.lineWidth = brushDiameter;\n\t\tcontext.lineCap = 'round';\n\t\tcontext.fillStyle = chalks[ colorIdx ].color; // 'rgba(255,255,255,0.5)';\n\t\tcontext.strokeStyle = chalks[ colorIdx ].color;\n\t\t/*var opacity = Math.min(0.8, Math.max(0,color[1].replace(/^.*,(.+)\\)/,'$1') - 0.1)) + Math.random()*0.2;*/\n\t\tvar opacity = 1.0;\n\t\tcontext.strokeStyle = context.strokeStyle.replace( /[\\d\\.]+\\)$/g, opacity + ')' );\n\t\tcontext.beginPath();\n\t\tcontext.moveTo( fromX, fromY );\n\t\tcontext.lineTo( toX, toY );\n\t\tcontext.stroke();\n\t\t// Chalk Effect\n\t\tvar length = Math.round( Math.sqrt( Math.pow( toX - fromX, 2 ) + Math.pow( toY - fromY, 2 ) ) / ( 5 / brushDiameter ) );\n\t\tvar xUnit = ( toX - fromX ) / length;\n\t\tvar yUnit = ( toY - fromY ) / length;\n\t\tfor ( var i = 0; i < length; i++ ) {\n\t\t\tif ( chalkEffect > ( Math.random() * 0.9 ) ) {\n\t\t\t\tvar xCurrent = fromX + ( i * xUnit );\n\t\t\t\tvar yCurrent = fromY + ( i * yUnit );\n\t\t\t\tvar xRandom = xCurrent + ( Math.random() - 0.5 ) * brushDiameter * 1.2;\n\t\t\t\tvar yRandom = yCurrent + ( Math.random() - 0.5 ) * brushDiameter * 1.2;\n\t\t\t\tcontext.clearRect( xRandom, yRandom, Math.random() * 2 + 2, Math.random() + 1 );\n\t\t\t}\n\t\t}\n\t}\n \n\tfunction eraseWithSponge( context, x, y ) {\n\t\tcontext.save();\n\t\tcontext.beginPath();\n\t\tcontext.arc( x, y, eraser.radius, 0, 2 * Math.PI, false );\n\t\tcontext.clip();\n\t\tcontext.clearRect( x - eraser.radius - 1, y - eraser.radius - 1, eraser.radius * 2 + 2, eraser.radius * 2 + 2 );\n\t\tcontext.restore();\n\t\tif ( mode == 1 && grid ) {\n\t\t\tredrawGrid( x, y, eraser.radius );\n\t\t}\n\t}\n\n\n\t/**\n\t * Show an overlay for the chalkboard.\n\t */\n\tfunction showChalkboard() {\n//console.log(\"showChalkboard\");\n\t\tclearTimeout( touchTimeout );\n\t\ttouchTimeout = null;\n\t\tdrawingCanvas[ 0 ].sponge.style.visibility = 'hidden'; // make sure that the sponge from touch events is hidden\n\t\tdrawingCanvas[ 1 ].sponge.style.visibility = 'hidden'; // make sure that the sponge from touch events is hidden\n\t\tdrawingCanvas[ 1 ].container.style.opacity = 1;\n\t\tdrawingCanvas[ 1 ].container.style.visibility = 'visible';\n\t\tmode = 1;\n\t}\n\n\n\t/**\n\t * Closes open chalkboard.\n\t */\n\tfunction closeChalkboard() {\n\t\tclearTimeout( touchTimeout );\n\t\ttouchTimeout = null;\n\t\tdrawingCanvas[ 0 ].sponge.style.visibility = 'hidden'; // make sure that the sponge from touch events is hidden\n\t\tdrawingCanvas[ 1 ].sponge.style.visibility = 'hidden'; // make sure that the sponge from touch events is hidden\n\t\tdrawingCanvas[ 1 ].container.style.opacity = 0;\n\t\tdrawingCanvas[ 1 ].container.style.visibility = 'hidden';\n\t\tlastX = null;\n\t\tlastY = null;\n\t\tmode = 0;\n\t}\n\n\t/**\n\t * Clear current canvas.\n\t */\n\tfunction clearCanvas( id ) {\n\t\tif ( id == 0 ) clearTimeout( slidechangeTimeout );\n\t\tdrawingCanvas[ id ].context.clearRect( 0, 0, drawingCanvas[ id ].width, drawingCanvas[ id ].height );\n\t\tif ( id == 1 && grid ) drawGrid();\n\t}\n\n\t/**\n\t * Draw grid on background\n\t */\n\tfunction drawGrid() {\n\t\tvar context = drawingCanvas[ 1 ].context;\n\n\t\tdrawingCanvas[ 1 ].scale = Math.min( drawingCanvas[ 1 ].width / storage[ 1 ].width, drawingCanvas[ 1 ].height / storage[ 1 ].height );\n\t\tdrawingCanvas[ 1 ].xOffset = ( drawingCanvas[ 1 ].width - storage[ 1 ].width * drawingCanvas[ 1 ].scale ) / 2;\n\t\tdrawingCanvas[ 1 ].yOffset = ( drawingCanvas[ 1 ].height - storage[ 1 ].height * drawingCanvas[ 1 ].scale ) / 2;\n\n\t\tvar scale = drawingCanvas[ 1 ].scale;\n\t\tvar xOffset = drawingCanvas[ 1 ].xOffset;\n\t\tvar yOffset = drawingCanvas[ 1 ].yOffset;\n\n\t\tvar distance = grid.distance * scale;\n\n\t\tvar fromX = drawingCanvas[ 1 ].width / 2 - distance / 2 - Math.floor( ( drawingCanvas[ 1 ].width - distance ) / 2 / distance ) * distance;\n\t\tfor ( var x = fromX; x < drawingCanvas[ 1 ].width; x += distance ) {\n\t\t\tcontext.beginPath();\n\t\t\tcontext.lineWidth = grid.width * scale;\n\t\t\tcontext.lineCap = 'round';\n\t\t\tcontext.fillStyle = grid.color;\n\t\t\tcontext.strokeStyle = grid.color;\n\t\t\tcontext.moveTo( x, 0 );\n\t\t\tcontext.lineTo( x, drawingCanvas[ 1 ].height );\n\t\t\tcontext.stroke();\n\t\t}\n\t\tvar fromY = drawingCanvas[ 1 ].height / 2 - distance / 2 - Math.floor( ( drawingCanvas[ 1 ].height - distance ) / 2 / distance ) * distance;\n\n\t\tfor ( var y = fromY; y < drawingCanvas[ 1 ].height; y += distance ) {\n\t\t\tcontext.beginPath();\n\t\t\tcontext.lineWidth = grid.width * scale;\n\t\t\tcontext.lineCap = 'round';\n\t\t\tcontext.fillStyle = grid.color;\n\t\t\tcontext.strokeStyle = grid.color;\n\t\t\tcontext.moveTo( 0, y );\n\t\t\tcontext.lineTo( drawingCanvas[ 1 ].width, y );\n\t\t\tcontext.stroke();\n\t\t}\n\t}\n\n\tfunction redrawGrid( centerX, centerY, diameter ) {\n\t\tvar context = drawingCanvas[ 1 ].context;\n\n\t\tdrawingCanvas[ 1 ].scale = Math.min( drawingCanvas[ 1 ].width / storage[ 1 ].width, drawingCanvas[ 1 ].height / storage[ 1 ].height );\n\t\tdrawingCanvas[ 1 ].xOffset = ( drawingCanvas[ 1 ].width - storage[ 1 ].width * drawingCanvas[ 1 ].scale ) / 2;\n\t\tdrawingCanvas[ 1 ].yOffset = ( drawingCanvas[ 1 ].height - storage[ 1 ].height * drawingCanvas[ 1 ].scale ) / 2;\n\n\t\tvar scale = drawingCanvas[ 1 ].scale;\n\t\tvar xOffset = drawingCanvas[ 1 ].xOffset;\n\t\tvar yOffset = drawingCanvas[ 1 ].yOffset;\n\n\t\tvar distance = grid.distance * scale;\n\n\t\tvar fromX = drawingCanvas[ 1 ].width / 2 - distance / 2 - Math.floor( ( drawingCanvas[ 1 ].width - distance ) / 2 / distance ) * distance;\n\n\t\tfor ( var x = fromX + distance * Math.ceil( ( centerX - diameter - fromX ) / distance ); x <= fromX + distance * Math.floor( ( centerX + diameter - fromX ) / distance ); x += distance ) {\n\t\t\tcontext.beginPath();\n\t\t\tcontext.lineWidth = grid.width * scale;\n\t\t\tcontext.lineCap = 'round';\n\t\t\tcontext.fillStyle = grid.color;\n\t\t\tcontext.strokeStyle = grid.color;\n\t\t\tcontext.moveTo( x, centerY - Math.sqrt( diameter * diameter - ( centerX - x ) * ( centerX - x ) ) );\n\t\t\tcontext.lineTo( x, centerY + Math.sqrt( diameter * diameter - ( centerX - x ) * ( centerX - x ) ) );\n\t\t\tcontext.stroke();\n\t\t}\n\t\tvar fromY = drawingCanvas[ 1 ].height / 2 - distance / 2 - Math.floor( ( drawingCanvas[ 1 ].height - distance ) / 2 / distance ) * distance;\n\t\tfor ( var y = fromY + distance * Math.ceil( ( centerY - diameter - fromY ) / distance ); y <= fromY + distance * Math.floor( ( centerY + diameter - fromY ) / distance ); y += distance ) {\n\t\t\tcontext.beginPath();\n\t\t\tcontext.lineWidth = grid.width * scale;\n\t\t\tcontext.lineCap = 'round';\n\t\t\tcontext.fillStyle = grid.color;\n\t\t\tcontext.strokeStyle = grid.color;\n\t\t\tcontext.moveTo( centerX - Math.sqrt( diameter * diameter - ( centerY - y ) * ( centerY - y ) ), y );\n\t\t\tcontext.lineTo( centerX + Math.sqrt( diameter * diameter - ( centerY - y ) * ( centerY - y ) ), y );\n\t\t\tcontext.stroke();\n\t\t}\n\t}\n\n\t/**\n\t * Set the  color\n\t */\n\tfunction setColor( index, record ) {\n\t\t// protect against out of bounds (this could happen when\n\t\t// replaying events recorded with different color settings).\n\t\tif ( index >= pens[ mode ].length ) index = 0;\n\t\tcolor[ mode ] = index;\n\t\tdrawingCanvas[ mode ].canvas.style.cursor = pens[ mode ][ color[ mode ] ].cursor;\n\t}\n\n\t/**\n\t * Set the  board\n\t */\n\tfunction selectBoard( boardIdx, record ) {\n//console.log(\"Set board\",boardIdx);\n\t\tif ( board == boardIdx ) return;\n\n\t\tboard = boardIdx;\n\t\tredrawChalkboard( boardIdx );\n\t\tif ( record ) {\n\t\t\trecordEvent( { type: 'selectboard' } );\n\t\t}\n\t}\n\n\tfunction redrawChalkboard( boardIdx ) {\n\t\tclearCanvas( 1 );\n\t\tvar slideData = getSlideData( slideIndices, 1 );\n\t\tvar index = 0;\n\t\tvar play = ( boardIdx == 0 );\n\t\twhile ( index < slideData.events.length && slideData.events[ index ].time < Date.now() - slideStart ) {\n\t\t\tif ( boardIdx == slideData.events[ index ].board ) {\n\t\t\t\tplayEvent( 1, slideData.events[ index ], Date.now() - slideStart );\n\t\t\t}\n\n\t\t\tindex++;\n\t\t}\n\t}\n\n\n\t/**\n\t * Forward cycle color\n\t */\n\tfunction cycleColorNext() {\n\t\tcolor[ mode ] = ( color[ mode ] + 1 ) % pens[ mode ].length;\n\t\treturn color[ mode ];\n\t}\n\n\t/**\n\t * Backward cycle color\n\t */\n\tfunction cycleColorPrev() {\n\t\tcolor[ mode ] = ( color[ mode ] + ( pens[ mode ].length - 1 ) ) % pens[ mode ].length;\n\t\treturn color[ mode ];\n\t}\n\n/*****************************************************************\n ** Broadcast\n ******************************************************************/\n\n\tvar eventQueue = [];\n\n\tdocument.addEventListener( 'received', function ( message ) {\n\t\tif ( message.content && message.content.sender == 'chalkboard-plugin' ) {\n\t\t\t// add message to queue\n\t\t\teventQueue.push( message );\n\t\t\tconsole.log( JSON.stringify( message ) );\n\t\t}\n\t\tif ( eventQueue.length == 1 ) processQueue();\n\t} );\n\n\tfunction processQueue() {\n\t\t// take first message from queue\n\t\tvar message = eventQueue.shift();\n\n\t\t// synchronize time with seminar host\n\t\tslideStart = Date.now() - message.content.timestamp;\n\t\t// set status\n\t\tif ( mode < message.content.mode ) {\n\t\t\t// open chalkboard\n\t\t\tshowChalkboard();\n\t\t} else if ( mode > message.content.mode ) {\n\t\t\t// close chalkboard\n\t\t\tcloseChalkboard();\n\t\t}\n\t\tif ( board != message.content.board ) {\n\t\t\tboard = message.content.board;\n\t\t\tredrawChalkboard( board );\n\t\t};\n\n\t\tswitch ( message.content.type ) {\n\t\tcase 'showChalkboard':\n\t\t\tshowChalkboard();\n\t\t\tbreak;\n\t\tcase 'closeChalkboard':\n\t\t\tcloseChalkboard();\n\t\t\tbreak;\n\t\tcase 'erase':\n\t\t\terasePoint( message.content.x, message.content.y );\n\t\t\tbreak;\n\t\tcase 'draw':\n\t\t\tdrawSegment( message.content.fromX, message.content.fromY, message.content.toX, message.content.toY, message.content.color );\n\t\t\tbreak;\n\t\tcase 'clear':\n\t\t\tclearSlide();\n\t\t\tbreak;\n\t\tcase 'selectboard':\n\t\t\tselectBoard( message.content.board, true );\n\t\t\tbreak;\n\t\tcase 'resetSlide':\n\t\t\tresetSlideDrawings();\n\t\t\tbreak;\n\t\tcase 'init':\n\t\t\tstorage = message.content.storage;\n\t\t\tfor ( var id = 0; id < 2; id++ ) {\n\t\t\t\tdrawingCanvas[ id ].scale = Math.min( drawingCanvas[ id ].width / storage[ id ].width, drawingCanvas[ id ].height / storage[ id ].height );\n\t\t\t\tdrawingCanvas[ id ].xOffset = ( drawingCanvas[ id ].width - storage[ id ].width * drawingCanvas[ id ].scale ) / 2;\n\t\t\t\tdrawingCanvas[ id ].yOffset = ( drawingCanvas[ id ].height - storage[ id ].height * drawingCanvas[ id ].scale ) / 2;\n\t\t\t}\n\t\t\tclearCanvas( 0 );\n\t\t\tclearCanvas( 1 );\n\t\t\tif ( !playback ) {\n\t\t\t\tslidechangeTimeout = setTimeout( startPlayback, transition, getSlideDuration(), 0 );\n\t\t\t}\n\t\t\tif ( mode == 1 && message.content.mode == 0 ) {\n\t\t\t\tsetTimeout( closeChalkboard, transition + 50 );\n\t\t\t}\n\t\t\tif ( mode == 0 && message.content.mode == 1 ) {\n\t\t\t\tsetTimeout( showChalkboard, transition + 50 );\n\t\t\t}\n\t\t\tmode = message.content.mode;\n\t\t\tboard = message.content.board;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\t// continue with next message if queued\n\t\tif ( eventQueue.length > 0 ) {\n\t\t\tprocessQueue();\n\t\t} else {\n\t\t\tstorageChanged();\n\t\t}\n\t}\n\n\tdocument.addEventListener( 'welcome', function ( user ) {\n\t\t// broadcast storage\n\t\tvar message = new CustomEvent( messageType );\n\t\tmessage.content = {\n\t\t\tsender: 'chalkboard-plugin',\n\t\t\trecipient: user.id,\n\t\t\ttype: 'init',\n\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\tstorage: storage,\n\t\t\tmode,\n\t\t\tboard\n\t\t};\n\t\tdocument.dispatchEvent( message );\n\t} );\n\n\t/*****************************************************************\n\t ** Playback\n\t ******************************************************************/\n\n\tdocument.addEventListener( 'seekplayback', function ( event ) {\n//console.log('event seekplayback ' + event.timestamp);\n\t\tstopPlayback();\n\t\tif ( !playback || event.timestamp == 0 ) {\n\t\t\t// in other cases startplayback fires after seeked\n\t\t\tstartPlayback( event.timestamp );\n\t\t}\n\t\t//console.log('seeked');\n\t} );\n\n\n\tdocument.addEventListener( 'startplayback', function ( event ) {\n//console.log('event startplayback ' + event.timestamp);\n\t\tstopPlayback();\n\t\tplayback = true;\n\t\tstartPlayback( event.timestamp );\n\t} );\n\n\tdocument.addEventListener( 'stopplayback', function ( event ) {\n//console.log('event stopplayback ' + (Date.now() - slideStart) );\n\t\tplayback = false;\n\t\tstopPlayback();\n\t} );\n\n\tdocument.addEventListener( 'startrecording', function ( event ) {\n//console.log('event startrecording ' + event.timestamp);\n\t\tstartRecording();\n\t} );\n\n\n\tfunction startRecording() {\n\t\tresetSlide( true );\n\t\tslideStart = Date.now();\n\t}\n\n\tfunction startPlayback( timestamp, finalMode ) {\n//console.log(\"playback \" + timestamp );\n\t\tslideStart = Date.now() - timestamp;\n\t\tcloseChalkboard();\n\t\tmode = 0;\n\t\tboard = 0;\n\t\tfor ( var id = 0; id < 2; id++ ) {\n\t\t\tclearCanvas( id );\n\t\t\tvar slideData = getSlideData( slideIndices, id );\n//console.log( timestamp +\" / \" + JSON.stringify(slideData));\n\t\t\tvar index = 0;\n\t\t\twhile ( index < slideData.events.length && slideData.events[ index ].time < ( Date.now() - slideStart ) ) {\n\t\t\t\tplayEvent( id, slideData.events[ index ], timestamp );\n\t\t\t\tindex++;\n\t\t\t}\n\n\t\t\twhile ( playback && index < slideData.events.length ) {\n\t\t\t\ttimeouts[ id ].push( setTimeout( playEvent, slideData.events[ index ].time - ( Date.now() - slideStart ), id, slideData.events[ index ], timestamp ) );\n\t\t\t\tindex++;\n\t\t\t}\n\t\t}\n//console.log(\"Mode: \" + finalMode + \"/\" + mode );\n\t\tif ( finalMode != undefined ) {\n\t\t\tmode = finalMode;\n\t\t}\n\t\tif ( mode == 1 ) showChalkboard();\n//console.log(\"playback (ok)\");\n\n\t};\n\n\tfunction stopPlayback() {\n//console.log(\"stopPlayback\");\n//console.log(\"Timeouts: \" + timeouts[0].length + \"/\"+ timeouts[1].length);\n\t\tfor ( var id = 0; id < 2; id++ ) {\n\t\t\tfor ( var i = 0; i < timeouts[ id ].length; i++ ) {\n\t\t\t\tclearTimeout( timeouts[ id ][ i ] );\n\t\t\t}\n\t\t\ttimeouts[ id ] = [];\n\t\t}\n\t};\n\n\tfunction playEvent( id, event, timestamp ) {\n//console.log( timestamp +\" / \" + JSON.stringify(event));\n//console.log( id + \": \" + timestamp +\" / \" +  event.time +\" / \" + event.type +\" / \" + mode );\n\t\tswitch ( event.type ) {\n\t\tcase 'open':\n\t\t\tif ( timestamp <= event.time ) {\n\t\t\t\tshowChalkboard();\n\t\t\t} else {\n\t\t\t\tmode = 1;\n\t\t\t}\n\n\t\t\tbreak;\n\t\tcase 'close':\n\t\t\tif ( timestamp < event.time ) {\n\t\t\t\tcloseChalkboard();\n\t\t\t} else {\n\t\t\t\tmode = 0;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'clear':\n\t\t\tclearCanvas( id );\n\t\t\tbreak;\n\t\tcase 'selectboard':\n\t\t\tselectBoard( event.board );\n\t\t\tbreak;\n\t\tcase 'draw':\n\t\t\tdrawLine( id, event, timestamp );\n\t\t\tbreak;\n\t\tcase 'erase':\n\t\t\teraseCircle( id, event, timestamp );\n\t\t\tbreak;\n\t\t}\n\t};\n\n\tfunction drawLine( id, event, timestamp ) {\n\t\tvar ctx = drawingCanvas[ id ].context;\n\t\tvar scale = drawingCanvas[ id ].scale;\n\t\tvar xOffset = drawingCanvas[ id ].xOffset;\n\t\tvar yOffset = drawingCanvas[ id ].yOffset;\n\t\tdraw[ id ]( ctx, xOffset + event.x1 * scale, yOffset + event.y1 * scale, xOffset + event.x2 * scale, yOffset + event.y2 * scale, event.color );\n\t};\n\n\tfunction eraseCircle( id, event, timestamp ) {\n\t\tvar ctx = drawingCanvas[ id ].context;\n\t\tvar scale = drawingCanvas[ id ].scale;\n\t\tvar xOffset = drawingCanvas[ id ].xOffset;\n\t\tvar yOffset = drawingCanvas[ id ].yOffset;\n\n\t\teraseWithSponge( ctx, xOffset + event.x * scale, yOffset + event.y * scale );\n\t};\n\n\tfunction startErasing( x, y ) {\n\t\tdrawing = false;\n\t\terasing = true;\n\t\tdrawingCanvas[ mode ].sponge.style.visibility = 'visible';\n\t\terasePoint( x, y );\n\t}\n\n\tfunction erasePoint( x, y ) {\n\t\tvar ctx = drawingCanvas[ mode ].context;\n\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\n\t\t// move sponge image\n\t\tdrawingCanvas[ mode ].sponge.style.left = ( x * scale + xOffset - eraser.radius ) + 'px';\n\t\tdrawingCanvas[ mode ].sponge.style.top = ( y * scale + yOffset - 2 * eraser.radius ) + 'px';\n\n\t\trecordEvent( {\n\t\t\ttype: 'erase',\n\t\t\tx,\n\t\t\ty\n\t\t} );\n\n\t\tif (\n\t\t\tx * scale + xOffset > 0 &&\n\t\t\ty * scale + yOffset > 0 &&\n\t\t\tx * scale + xOffset < drawingCanvas[ mode ].width &&\n\t\t\ty * scale + yOffset < drawingCanvas[ mode ].height\n\t\t) {\n\t\t\teraseWithSponge( ctx, x * scale + xOffset, y * scale + yOffset );\n\t\t}\n\t}\n\n\tfunction stopErasing() {\n\t\terasing = false;\n\t\t// hide sponge\n\t\tdrawingCanvas[ mode ].sponge.style.visibility = 'hidden';\n\t}\n\n\tfunction startDrawing( x, y ) {\n\t\tdrawing = true;\n\n\t\tvar ctx = drawingCanvas[ mode ].context;\n\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\t\tlastX = x * scale + xOffset;\n\t\tlastY = y * scale + yOffset;\n\t}\n\n\tfunction drawSegment( fromX, fromY, toX, toY, colorIdx ) {\n\t\tvar ctx = drawingCanvas[ mode ].context;\n\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\n\t\trecordEvent( {\n\t\t\ttype: 'draw',\n\t\t\tcolor: colorIdx,\n\t\t\tx1: fromX,\n\t\t\ty1: fromY,\n\t\t\tx2: toX,\n\t\t\ty2: toY\n\t\t} );\n\n\t\tif (\n\t\t\tfromX * scale + xOffset > 0 &&\n\t\t\tfromY * scale + yOffset > 0 &&\n\t\t\tfromX * scale + xOffset < drawingCanvas[ mode ].width &&\n\t\t\tfromY * scale + yOffset < drawingCanvas[ mode ].height &&\n\t\t\ttoX * scale + xOffset > 0 &&\n\t\t\ttoY * scale + yOffset > 0 &&\n\t\t\ttoX * scale + xOffset < drawingCanvas[ mode ].width &&\n\t\t\ttoY * scale + yOffset < drawingCanvas[ mode ].height\n\t\t) {\n\t\t\tdraw[ mode ]( ctx, fromX * scale + xOffset, fromY * scale + yOffset, toX * scale + xOffset, toY * scale + yOffset, colorIdx );\n\t\t}\n\t}\n\n\tfunction stopDrawing() {\n\t\tdrawing = false;\n\t}\n\n\n/*****************************************************************\n ** User interface\n ******************************************************************/\n\n\tfunction setupCanvasEvents( canvas ) {\n// TODO: check all touchevents\n\t\tcanvas.addEventListener( 'touchstart', function ( evt ) {\n\t\t\tevt.preventDefault();\n//console.log(\"Touch start\");\n\t\t\tif ( !readOnly && evt.target.getAttribute( 'data-chalkboard' ) == mode ) {\n\t\t\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\t\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\t\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\n\t\t\t\tvar touch = evt.touches[ 0 ];\n\t\t\t\tmouseX = touch.pageX;\n\t\t\t\tmouseY = touch.pageY;\n\t\t\t\tstartDrawing( ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale );\n\t\t\t\ttouchTimeout = setTimeout( startErasing, 500,  ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale );\n\t\t\t}\n\t\t}, passiveSupported ? {\n\t\t\tpassive: false\n\t\t} : false );\n\n\t\tcanvas.addEventListener( 'touchmove', function ( evt ) {\n\t\t\tevt.preventDefault();\n//console.log(\"Touch move\");\n\t\t\tclearTimeout( touchTimeout );\n\t\t\ttouchTimeout = null;\n\t\t\tif ( drawing || erasing ) {\n\t\t\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\t\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\t\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\n\t\t\t\tvar touch = evt.touches[ 0 ];\n\t\t\t\tmouseX = touch.pageX;\n\t\t\t\tmouseY = touch.pageY;\n\t\t\t\tif ( mouseY < drawingCanvas[ mode ].height && mouseX < drawingCanvas[ mode ].width ) {\n\t\t\t\t\t// move sponge\n\t\t\t\t\tif ( event.type == 'erase' ) {\n\t\t\t\t\t\tdrawingCanvas[ mode ].sponge.style.left = ( mouseX - eraser.radius ) + 'px';\n\t\t\t\t\t\tdrawingCanvas[ mode ].sponge.style.top = ( mouseY - eraser.radius ) + 'px';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( drawing ) {\n\t\t\t\t\tdrawSegment( ( lastX - xOffset ) / scale, ( lastY - yOffset ) / scale, ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale, color[ mode ] );\n\t\t\t\t\t// broadcast\n\t\t\t\t\tvar message = new CustomEvent( messageType );\n\t\t\t\t\tmessage.content = {\n\t\t\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\t\t\ttype: 'draw',\n\t\t\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\t\t\tmode,\n\t\t\t\t\t\tboard,\n\t\t\t\t\t\tfromX: ( lastX - xOffset ) / scale,\n\t\t\t\t\t\tfromY: ( lastY - yOffset ) / scale,\n\t\t\t\t\t\ttoX: ( mouseX - xOffset ) / scale,\n\t\t\t\t\t\ttoY: ( mouseY - yOffset ) / scale,\n\t\t\t\t\t\tcolor: color[ mode ]\n\t\t\t\t\t};\n\t\t\t\t\tdocument.dispatchEvent( message );\n\n\t\t\t\t\tlastX = mouseX;\n\t\t\t\t\tlastY = mouseY;\n\t\t\t\t} else {\n\t\t\t\t\terasePoint( ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale );\n\t\t\t\t\t// broadcast\n\t\t\t\t\tvar message = new CustomEvent( messageType );\n\t\t\t\t\tmessage.content = {\n\t\t\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\t\t\ttype: 'erase',\n\t\t\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\t\t\tmode,\n\t\t\t\t\t\tboard,\n\t\t\t\t\t\tx: ( mouseX - xOffset ) / scale,\n\t\t\t\t\t\ty: ( mouseY - yOffset ) / scale\n\t\t\t\t\t};\n\t\t\t\t\tdocument.dispatchEvent( message );\n\t\t\t\t}\n\n\t\t\t}\n\t\t}, false );\n\n\n\t\tcanvas.addEventListener( 'touchend', function ( evt ) {\n\t\t\tevt.preventDefault();\n\t\t\tclearTimeout( touchTimeout );\n\t\t\ttouchTimeout = null;\n\t\t\t// hide sponge image\n\t\t\tdrawingCanvas[ mode ].sponge.style.visibility = 'hidden';\n\t\t\tstopDrawing();\n\t\t}, false );\n\n\t\tcanvas.addEventListener( 'mousedown', function ( evt ) {\n\t\t\tevt.preventDefault();\n\t\t\tif ( !readOnly && evt.target.getAttribute( 'data-chalkboard' ) == mode ) {\n//console.log( \"mousedown: \" + evt.button );\n\t\t\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\t\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\t\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\n\t\t\t\tmouseX = evt.pageX;\n\t\t\t\tmouseY = evt.pageY;\n\n\t\t\t\tif ( evt.button == 2 || evt.button == 1 ) {\n\t\t\t\t\tstartErasing( ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale );\n\t\t\t\t\t// broadcast\n\t\t\t\t\tvar message = new CustomEvent( messageType );\n\t\t\t\t\tmessage.content = {\n\t\t\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\t\t\ttype: 'erase',\n\t\t\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\t\t\tmode,\n\t\t\t\t\t\tboard,\n\t\t\t\t\t\tx: ( mouseX - xOffset ) / scale,\n\t\t\t\t\t\ty: ( mouseY - yOffset ) / scale\n\t\t\t\t\t};\n\t\t\t\t\tdocument.dispatchEvent( message );\n\t\t\t\t} else {\n\t\t\t\t\tstartDrawing( ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\tcanvas.addEventListener( 'mousemove', function ( evt ) {\n\t\t\tevt.preventDefault();\n//console.log(\"Mouse move\");\n\t\t\tif ( drawing || erasing ) {\n\t\t\t\tvar scale = drawingCanvas[ mode ].scale;\n\t\t\t\tvar xOffset = drawingCanvas[ mode ].xOffset;\n\t\t\t\tvar yOffset = drawingCanvas[ mode ].yOffset;\n\n\t\t\t\tmouseX = evt.pageX;\n\t\t\t\tmouseY = evt.pageY;\n\n\t\t\t\tif ( drawing ) {\n\t\t\t\t\tdrawSegment( ( lastX - xOffset ) / scale, ( lastY - yOffset ) / scale, ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale, color[ mode ] );\n\t\t\t\t\t// broadcast\n\t\t\t\t\tvar message = new CustomEvent( messageType );\n\t\t\t\t\tmessage.content = {\n\t\t\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\t\t\ttype: 'draw',\n\t\t\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\t\t\tmode,\n\t\t\t\t\t\tboard,\n\t\t\t\t\t\tfromX: ( lastX - xOffset ) / scale,\n\t\t\t\t\t\tfromY: ( lastY - yOffset ) / scale,\n\t\t\t\t\t\ttoX: ( mouseX - xOffset ) / scale,\n\t\t\t\t\t\ttoY: ( mouseY - yOffset ) / scale,\n\t\t\t\t\t\tcolor: color[ mode ]\n\t\t\t\t\t};\n\t\t\t\t\tdocument.dispatchEvent( message );\n\n\t\t\t\t\tlastX = mouseX;\n\t\t\t\t\tlastY = mouseY;\n\t\t\t\t} else {\n\t\t\t\t\terasePoint( ( mouseX - xOffset ) / scale, ( mouseY - yOffset ) / scale );\n\t\t\t\t\t// broadcast\n\t\t\t\t\tvar message = new CustomEvent( messageType );\n\t\t\t\t\tmessage.content = {\n\t\t\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\t\t\ttype: 'erase',\n\t\t\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\t\t\tmode,\n\t\t\t\t\t\tboard,\n\t\t\t\t\t\tx: ( mouseX - xOffset ) / scale,\n\t\t\t\t\t\ty: ( mouseY - yOffset ) / scale\n\t\t\t\t\t};\n\t\t\t\t\tdocument.dispatchEvent( message );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\n\n\t\tcanvas.addEventListener( 'mouseup', function ( evt ) {\n\t\t\tevt.preventDefault();\n\t\t\tdrawingCanvas[ mode ].canvas.style.cursor = pens[ mode ][ color[ mode ] ].cursor;\n\t\t\tif ( drawing || erasing ) {\n\t\t\t\tstopDrawing();\n\t\t\t\tstopErasing();\n\t\t\t}\n\t\t} );\n\t}\n\n\tfunction resize() {\n//console.log(\"resize\");\n\t\t// Resize the canvas and draw everything again\n\t\tvar timestamp = Date.now() - slideStart;\n\t\tif ( !playback ) {\n\t\t\ttimestamp = getSlideDuration();\n\t\t}\n\n//console.log( drawingCanvas[0].scale + \"/\" + drawingCanvas[0].xOffset + \"/\" +drawingCanvas[0].yOffset );\n\t\tfor ( var id = 0; id < 2; id++ ) {\n\t\t\tdrawingCanvas[ id ].width = window.innerWidth;\n\t\t\tdrawingCanvas[ id ].height = window.innerHeight;\n\t\t\tdrawingCanvas[ id ].canvas.width = drawingCanvas[ id ].width;\n\t\t\tdrawingCanvas[ id ].canvas.height = drawingCanvas[ id ].height;\n\t\t\tdrawingCanvas[ id ].context.canvas.width = drawingCanvas[ id ].width;\n\t\t\tdrawingCanvas[ id ].context.canvas.height = drawingCanvas[ id ].height;\n\n\t\t\tdrawingCanvas[ id ].scale = Math.min( drawingCanvas[ id ].width / storage[ id ].width, drawingCanvas[ id ].height / storage[ id ].height );\n\t\t\tdrawingCanvas[ id ].xOffset = ( drawingCanvas[ id ].width - storage[ id ].width * drawingCanvas[ id ].scale ) / 2;\n\t\t\tdrawingCanvas[ id ].yOffset = ( drawingCanvas[ id ].height - storage[ id ].height * drawingCanvas[ id ].scale ) / 2;\n//console.log( drawingCanvas[id].scale + \"/\" + drawingCanvas[id].xOffset + \"/\" +drawingCanvas[id].yOffset );\n\t\t}\n//console.log( window.innerWidth + \"/\" + window.innerHeight);\n\t\tstartPlayback( timestamp, mode, true );\n\t}\n\n\tReveal.addEventListener( 'pdf-ready', function ( evt ) {\n//\t\tconsole.log( \"Create printouts when ready\" );\n\t\twhenLoaded( createPrintout );\n\t});\n\n\tReveal.addEventListener( 'ready', function ( evt ) {\n//console.log('ready');\n\t\tif ( !printMode ) {\n\t\t\twindow.addEventListener( 'resize', resize );\n\n\t\t\tslideStart = Date.now() - getSlideDuration();\n\t\t\tslideIndices = Reveal.getIndices();\n\t\t\tif ( !playback ) {\n\t\t\t\tstartPlayback( getSlideDuration(), 0 );\n\t\t\t}\n\t\t\tif ( Reveal.isAutoSliding() ) {\n\t\t\t\tvar event = new CustomEvent( 'startplayback' );\n\t\t\t\tevent.timestamp = 0;\n\t\t\t\tdocument.dispatchEvent( event );\n\t\t\t}\n\t\t\tupdateStorage();\n\t\t\twhenReady( addPageNumbers );\n\t\t}\n\t} );\n\tReveal.addEventListener( 'slidechanged', function ( evt ) {\n//\t\tclearTimeout( slidechangeTimeout );\n//console.log('slidechanged');\n\t\tif ( !printMode ) {\n\t\t\tslideStart = Date.now() - getSlideDuration();\n\t\t\tslideIndices = Reveal.getIndices();\n\t\t\tcloseChalkboard();\n\t\t\tboard = 0;\n\t\t\tclearCanvas( 0 );\n\t\t\tclearCanvas( 1 );\n\t\t\tif ( !playback ) {\n\t\t\t\tslidechangeTimeout = setTimeout( startPlayback, transition, getSlideDuration(), 0 );\n\t\t\t}\n\t\t\tif ( Reveal.isAutoSliding() ) {\n\t\t\t\tvar event = new CustomEvent( 'startplayback' );\n\t\t\t\tevent.timestamp = 0;\n\t\t\t\tdocument.dispatchEvent( event );\n\t\t\t}\n\t\t}\n\t} );\n\tReveal.addEventListener( 'fragmentshown', function ( evt ) {\n//\t\tclearTimeout( slidechangeTimeout );\n//console.log('fragmentshown');\n\t\tif ( !printMode ) {\n\t\t\tslideStart = Date.now() - getSlideDuration();\n\t\t\tslideIndices = Reveal.getIndices();\n\t\t\tcloseChalkboard();\n\t\t\tboard = 0;\n\t\t\tclearCanvas( 0 );\n\t\t\tclearCanvas( 1 );\n\t\t\tif ( Reveal.isAutoSliding() ) {\n\t\t\t\tvar event = new CustomEvent( 'startplayback' );\n\t\t\t\tevent.timestamp = 0;\n\t\t\t\tdocument.dispatchEvent( event );\n\t\t\t} else if ( !playback ) {\n\t\t\t\tstartPlayback( getSlideDuration(), 0 );\n//\t\t\t\tcloseChalkboard();\n\t\t\t}\n\t\t}\n\t} );\n\tReveal.addEventListener( 'fragmenthidden', function ( evt ) {\n//\t\tclearTimeout( slidechangeTimeout );\n//console.log('fragmenthidden');\n\t\tif ( !printMode ) {\n\t\t\tslideStart = Date.now() - getSlideDuration();\n\t\t\tslideIndices = Reveal.getIndices();\n\t\t\tcloseChalkboard();\n\t\t\tboard = 0;\n\t\t\tclearCanvas( 0 );\n\t\t\tclearCanvas( 1 );\n\t\t\tif ( Reveal.isAutoSliding() ) {\n\t\t\t\tdocument.dispatchEvent( new CustomEvent( 'stopplayback' ) );\n\t\t\t} else if ( !playback ) {\n\t\t\t\tstartPlayback( getSlideDuration() );\n\t\t\t\tcloseChalkboard();\n\t\t\t}\n\t\t}\n\t} );\n\n\tReveal.addEventListener( 'autoslideresumed', function ( evt ) {\n//console.log('autoslideresumed');\n\t\tvar event = new CustomEvent( 'startplayback' );\n\t\tevent.timestamp = 0;\n\t\tdocument.dispatchEvent( event );\n\t} );\n\tReveal.addEventListener( 'autoslidepaused', function ( evt ) {\n//console.log('autoslidepaused');\n\t\tdocument.dispatchEvent( new CustomEvent( 'stopplayback' ) );\n\n\t\t// advance to end of slide\n//\t\tcloseChalkboard();\n\t\tstartPlayback( getSlideDuration(), 0 );\n\t} );\n\n\tfunction toggleNotesCanvas() {\n\t\tif ( !readOnly ) {\n\t\t\tif ( mode == 1 ) {\n\t\t\t\ttoggleChalkboard();\n\t\t\t\tnotescanvas.style.background = background[ 0 ]; //'rgba(255,0,0,0.5)';\n\t\t\t\tnotescanvas.style.pointerEvents = 'auto';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif ( notescanvas.style.pointerEvents != 'none' ) {\n\t\t\t\t\t// hide notes canvas\n\t\t\t\t\tif ( colorButtons ) {\n\t\t\t\t\t\tnotescanvas.querySelector( '.palette' ).style.visibility = 'hidden';\n\t\t\t\t\t}\n\t\t\t\t\tnotescanvas.style.background = 'rgba(0,0,0,0)';\n\t\t\t\t\tnotescanvas.style.pointerEvents = 'none';\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// show notes canvas\n\t\t\t\t\tif ( colorButtons ) {\n\t\t\t\t\t\tnotescanvas.querySelector( '.palette' ).style.visibility = 'visible';\n\t\t\t\t\t}\n\t\t\t\t\tnotescanvas.style.background = background[ 0 ]; //'rgba(255,0,0,0.5)';\n\t\t\t\t\tnotescanvas.style.pointerEvents = 'auto';\n\n\t\t\t\t\tvar idx = 0;\n\t\t\t\t\tif ( color[ mode ] ) {\n\t\t\t\t\t\tidx = color[ mode ];\n\t\t\t\t\t}\n\n\t\t\t\t\tsetColor( idx, true );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction toggleChalkboard() {\n//console.log(\"toggleChalkboard \" + mode);\n\t\tif ( mode == 1 ) {\n\t\t\tif ( !readOnly ) {\n\t\t\t\trecordEvent( { type: 'close' } );\n\t\t\t}\n\t\t\tcloseChalkboard();\n\n\t\t\t// broadcast\n\t\t\tvar message = new CustomEvent( messageType );\n\t\t\tmessage.content = {\n\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\ttype: 'closeChalkboard',\n\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\tmode: 0,\n\t\t\t\tboard\n\t\t\t};\n\t\t\tdocument.dispatchEvent( message );\n\n\n\t\t} else {\n\t\t\tshowChalkboard();\n\t\t\tif ( !readOnly ) {\n\t\t\t\trecordEvent( { type: 'open' } );\n\t\t\t\t// broadcast\n\t\t\t\tvar message = new CustomEvent( messageType );\n\t\t\t\tmessage.content = {\n\t\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\t\ttype: 'showChalkboard',\n\t\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\t\tmode: 1,\n\t\t\t\t\tboard\n\t\t\t\t};\n\t\t\t\tdocument.dispatchEvent( message );\n\n\t\t\t\tvar idx = 0;\n\n\t\t\t\tif ( rememberColor[ mode ] ) {\n\t\t\t\t\tidx = color[ mode ];\n\t\t\t\t}\n\n\t\t\t\tsetColor( idx, true );\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction clearSlide() {\n\t\trecordEvent( { type: 'clear' } );\n\t\tclearCanvas( mode );\n\t}\n\n\tfunction clear() {\n\t\tif ( !readOnly ) {\n\t\t\tclearSlide();\n\t\t\t// broadcast\n\t\t\tvar message = new CustomEvent( messageType );\n\t\t\tmessage.content = {\n\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\ttype: 'clear',\n\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\tmode,\n\t\t\t\tboard\n\t\t\t};\n\t\t\tdocument.dispatchEvent( message );\n\t\t}\n\t};\n\n\tfunction colorIndex( idx ) {\n\t\tif ( !readOnly ) {\n\t\t\tsetColor( idx, true );\n\t\t}\n\t}\n\n\tfunction colorNext() {\n\t\tif ( !readOnly ) {\n\t\t\tlet idx = cycleColorNext();\n\t\t\tsetColor( idx, true );\n\t\t}\n\t}\n\n\tfunction colorPrev() {\n\t\tif ( !readOnly ) {\n\t\t\tlet idx = cycleColorPrev();\n\t\t\tsetColor( idx, true );\n\t\t}\n\t}\n\n\tfunction resetSlideDrawings() {\n\t\tslideStart = Date.now();\n\t\tcloseChalkboard();\n\n\t\tclearCanvas( 0 );\n\t\tclearCanvas( 1 );\n\n\t\tmode = 1;\n\t\tvar slideData = getSlideData();\n\t\tslideData.duration = 0;\n\t\tslideData.events = [];\n\t\tmode = 0;\n\t\tvar slideData = getSlideData();\n\t\tslideData.duration = 0;\n\t\tslideData.events = [];\n\n\t\tupdateStorage();\n\t}\n\n\tfunction resetSlide( force ) {\n\t\tvar ok = force || confirm( \"Please confirm to delete chalkboard drawings on this slide!\" );\n\t\tif ( ok ) {\n//console.log(\"resetSlide \");\n\t\t\tstopPlayback();\n\t\t\tresetSlideDrawings();\n\t\t\t// broadcast\n\t\t\tvar message = new CustomEvent( messageType );\n\t\t\tmessage.content = {\n\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\ttype: 'resetSlide',\n\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\tmode,\n\t\t\t\tboard\n\t\t\t};\n\t\t\tdocument.dispatchEvent( message );\n\t\t}\n\t};\n\n\tfunction resetStorage( force ) {\n\t\tvar ok = force || confirm( \"Please confirm to delete all chalkboard drawings!\" );\n\t\tif ( ok ) {\n\t\t\tstopPlayback();\n\t\t\tslideStart = Date.now();\n\t\t\tclearCanvas( 0 );\n\t\t\tclearCanvas( 1 );\n\t\t\tif ( mode == 1 ) {\n\t\t\t\tcloseChalkboard();\n\t\t\t}\n\n\t\t\tstorage = [ {\n\t\t\t\t\twidth: Reveal.getConfig().width,\n\t\t\t\t\theight: Reveal.getConfig().height,\n\t\t\t\t\tdata: []\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\twidth: Reveal.getConfig().width,\n\t\t\t\t\theight: Reveal.getConfig().height,\n\t\t\t\t\tdata: []\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tif ( config.storage ) {\n\t\t\t\tsessionStorage.setItem( config.storage, null )\n\t\t\t}\n\t\t\t// broadcast\n\t\t\tvar message = new CustomEvent( messageType );\n\t\t\tmessage.content = {\n\t\t\t\tsender: 'chalkboard-plugin',\n\t\t\t\ttype: 'init',\n\t\t\t\ttimestamp: Date.now() - slideStart,\n\t\t\t\tstorage,\n\t\t\t\tmode,\n\t\t\t\tboard\n\t\t\t};\n\t\t\tdocument.dispatchEvent( message );\n\t\t}\n\t};\n\n\tthis.toggleNotesCanvas = toggleNotesCanvas;\n\tthis.toggleChalkboard = toggleChalkboard;\n\tthis.colorIndex = colorIndex;\n\tthis.colorNext = colorNext;\n\tthis.colorPrev = colorPrev;\n\tthis.clear = clear;\n\tthis.reset = resetSlide;\n\tthis.resetAll = resetStorage;\n\tthis.download = downloadData;\n\tthis.updateStorage = updateStorage;\n\tthis.getData = getData;\n\tthis.configure = configure;\n\n\n\tfor ( var key in keyBindings ) {\n\t\tif ( keyBindings[ key ] ) {\n\t\t\tReveal.addKeyBinding( keyBindings[ key ], RevealChalkboard[ key ] );\n\t\t}\n\t};\n\n\treturn this;\n};\n"],"names":["window","RevealChalkboard","id","init","deck","initChalkboard","configure","config","toggleNotesCanvas","toggleChalkboard","colorIndex","colorNext","colorPrev","clear","reset","resetAll","updateStorage","getData","download","path","src","document","currentScript","sel","querySelector","undefined","slice","lastIndexOf","scriptPath","Reveal","background","draw","passiveSupported","addEventListener","Object","defineProperty","get","err","button","grid","boardmarkerWidth","chalkWidth","chalkEffect","rememberColor","eraser","radius","boardmarkers","color","cursor","chalks","keyBindings","keyCode","key","description","theme","toggleChalkboardButton","toggleNotesButton","colorButtons","boardHandle","transition","readOnly","messageType","getConfig","chalkboard","penWidth","drawWithBoardmarker","pens","distance","width","drawWithChalk","drawingCanvas","getElementById","style","clearCanvas","drawGrid","whenReady","callback","console","log","setTimeout","whenLoaded","loaded","warn","createElement","className","visibility","position","zIndex","fontSize","left","bottom","top","right","innerHTML","appendChild","setupDrawingCanvas","mode","board","mouseX","mouseY","lastX","lastY","drawing","erasing","slideStart","Date","now","slideIndices","h","v","timeouts","touchTimeout","slidechangeTimeout","updateStorageTimeout","playback","createPalette","colors","length","palette","classList","add","list","i","colorButton","setAttribute","e","element","target","hasAttribute","parentElement","parseInt","getAttribute","switchBoard","boardIdx","selectBoard","message","CustomEvent","content","sender","type","timestamp","dispatchEvent","container","oncontextmenu","innerWidth","height","innerHeight","scale","xOffset","yOffset","opacity","pointerEvents","aspectRatio","handle","preventDefault","sponge","canvas","context","getContext","evt","touch","touches","pageX","pageY","startDrawing","startErasing","passive","clearTimeout","event","drawSegment","fromX","fromY","toX","toY","erasePoint","x","y","stopDrawing","setupCanvasEvents","storage","data","initStorage","json","success","JSON","parse","Math","min","storageChanged","stringify","sessionStorage","setItem","recordEvent","time","slideData","getSlideData","events","splice","duration","max","indices","slide","f","page","Number","getCurrentSlide","push","getSlideDuration","getItem","filename","xhr","XMLHttpRequest","onload","readyState","status","responseText","open","send","error","loadData","printMode","test","location","search","addPageNumbers","slides","getSlides","toString","count","querySelectorAll","fragments","j","createPrintout","patImg","Image","drawings","createDrawings","addDrawings","getCanvas","template","oldCanvas","newCanvas","idx","findIndex","drawImage","unshift","imgCtx","fillStyle","createPattern","rect","fill","x1","y1","x2","y2","eraseWithSponge","clearRect","sort","a","b","parent","nextSlide","nextElementSibling","newPDFPage","append","insertBefore","colorIdx","lineWidth","lineCap","strokeStyle","beginPath","moveTo","lineTo","stroke","brushDiameter","replace","round","sqrt","pow","xUnit","yUnit","random","yCurrent","xRandom","yRandom","save","arc","PI","clip","restore","centerX","centerY","diameter","floor","ceil","redrawGrid","showChalkboard","closeChalkboard","setColor","index","record","redrawChalkboard","playEvent","eventQueue","processQueue","shift","clearSlide","resetSlideDrawings","startPlayback","finalMode","stopPlayback","ctx","drawLine","eraseCircle","resize","resetSlide","force","confirm","user","recipient","getIndices","isAutoSliding","this","notescanvas","body","blob","Blob","href","URL","createObjectURL","click","removeChild","addKeyBinding"],"sourceRoot":""}